{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>{% block meta_title %}{{ meta_title|default:SITE_NAME }}{% endblock %}</title>
    
    <meta name="description" content="{% block meta_description %}{{ meta_description|default:'Empresa constructora especializada en obra nueva, reformas y rehabilitaciones.' }}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}construcción, reformas, rehabilitación, obra nueva, constructora{% endblock %}">
    <link rel="canonical" href="{{ SITE_URL }}{% block canonical_url %}{{ request.path }}{% endblock %}">
    
    <meta property="og:title" content="{% block og_title %}{{ meta_title|default:SITE_NAME }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ meta_description|default:'Empresa constructora especializada en obra nueva, reformas y rehabilitaciones.' }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ SITE_URL }}{{ request.path }}">
    <meta property="og:image" content="{% block og_image %}{{ SITE_URL }}{% static 'images/og-default.jpg' %}{% endblock %}">
    <meta property="og:site_name" content="{{ SITE_NAME }}">
    <meta property="og:locale" content="es_ES">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ meta_title|default:SITE_NAME }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ meta_description }}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ SITE_URL }}{% static 'images/og-default.jpg' %}{% endblock %}">
    
    <link rel="stylesheet" href="{% static 'dist/output.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    {% block extra_css %}{% endblock %}
    
    {% block structured_data %}{% endblock %}
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-gray-50">
    <nav class="backdrop-blur-lg bg-white/80 shadow-lg sticky top-0 z-50 border-b border-gray-100">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-5">
                <div class="flex items-center space-x-3">
                    <a href="{% url 'home' %}" class="group">
                        <img src="{% static 'images/logo.png' %}" alt="{{ SITE_NAME }}" class="h-20 w-auto transition-all duration-300 group-hover:scale-110">
                    </a>
                </div>
                
                <button id="mobile-menu-button" class="md:hidden text-gray-700 focus:outline-none hover:text-primary-600 transition">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
                
                <div id="menu" class="hidden md:flex md:items-center md:space-x-1">
                    <a href="{% url 'home' %}" class="nav-link {% if request.path == '/' %}active{% endif %}">
                        <i class="fas fa-home mr-1"></i>{% trans "Inicio" %}
                    </a>
                    <a href="{% url 'about' %}" class="nav-link {% if 'sobre-nosotros' in request.path %}active{% endif %}">
                        <i class="fas fa-info-circle mr-1"></i>{% trans "Nosotros" %}
                    </a>
                    <a href="{% url 'services_list' %}" class="nav-link {% if 'servicios' in request.path %}active{% endif %}">
                        <i class="fas fa-tools mr-1"></i>{% trans "Servicios" %}
                    </a>
                    <a href="{% url 'blog_list' %}" class="nav-link {% if 'blog' in request.path %}active{% endif %}">
                        <i class="fas fa-newspaper mr-1"></i>Blog
                    </a>
                    <a href="{% url 'contact' %}" class="btn-primary-nav">
                        <i class="fas fa-envelope mr-2"></i>{% trans "Contacto" %}
                    </a>
                    
                    <!-- Selector de idioma -->
                    <div class="relative">
                        <button id="language-button" class="flex items-center space-x-1 px-4 py-2 text-gray-700 hover:text-primary-600 transition rounded-lg hover:bg-primary-50">
                            <i class="fas fa-globe"></i>
                            {% get_current_language as LANGUAGE_CODE %}
                            {{ LANGUAGE_CODE|upper }}
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div id="language-menu" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg py-2 z-50">
                            {% get_current_language as current_lang %}
                            <a href="#" data-lang="es" class="lang-switch block w-full text-left px-4 py-2 hover:bg-primary-50 transition {% if current_lang == 'es' %}bg-primary-100 font-bold{% endif %}">
                                Español
                            </a>
                            <a href="#" data-lang="ca" class="lang-switch block w-full text-left px-4 py-2 hover:bg-primary-50 transition {% if current_lang == 'ca' %}bg-primary-100 font-bold{% endif %}">
                                Català
                            </a>
                            <a href="#" data-lang="en" class="lang-switch block w-full text-left px-4 py-2 hover:bg-primary-50 transition {% if current_lang == 'en' %}bg-primary-100 font-bold{% endif %}">
                                English
                            </a>
                            <a href="#" data-lang="de" class="lang-switch block w-full text-left px-4 py-2 hover:bg-primary-50 transition {% if current_lang == 'de' %}bg-primary-100 font-bold{% endif %}">
                                Deutsch
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="mobile-menu" class="hidden md:hidden pb-4 space-y-2">
                <a href="{% url 'home' %}" class="block py-3 px-4 text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-lg transition">
                    <i class="fas fa-home mr-2"></i>{% trans "Inicio" %}
                </a>
                <a href="{% url 'about' %}" class="block py-3 px-4 text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-lg transition">
                    <i class="fas fa-info-circle mr-2"></i>{% trans "Sobre Nosotros" %}
                </a>
                <a href="{% url 'services_list' %}" class="block py-3 px-4 text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-lg transition">
                    <i class="fas fa-tools mr-2"></i>{% trans "Servicios" %}
                </a>
                <a href="{% url 'blog_list' %}" class="block py-3 px-4 text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-lg transition">
                    <i class="fas fa-newspaper mr-2"></i>Blog
                </a>
                <a href="{% url 'contact' %}" class="block py-3 px-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg hover:shadow-lg transition">
                    <i class="fas fa-envelope mr-2"></i>{% trans "Contacto" %}
                </a>
                
                <!-- Selector de idioma móvil -->
                <div class="border-t border-gray-200 pt-2 mt-2">
                    <button id="mobile-language-button" class="flex items-center justify-between w-full py-3 px-4 text-gray-700 hover:bg-primary-50 rounded-lg transition">
                        <span><i class="fas fa-globe mr-2"></i>{% get_current_language as LANGUAGE_CODE %}{{ LANGUAGE_CODE|upper }}</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div id="mobile-language-menu" class="hidden mt-1 ml-4 space-y-1">
                        {% get_current_language as current_lang %}
                        <a href="#" data-lang="es" class="lang-switch block py-2 px-4 text-gray-700 hover:bg-primary-50 rounded-lg transition {% if current_lang == 'es' %}bg-primary-100 font-bold{% endif %}">
                            Español
                        </a>
                        <a href="#" data-lang="ca" class="lang-switch block py-2 px-4 text-gray-700 hover:bg-primary-50 rounded-lg transition {% if current_lang == 'ca' %}bg-primary-100 font-bold{% endif %}">
                            Català
                        </a>
                        <a href="#" data-lang="en" class="lang-switch block py-2 px-4 text-gray-700 hover:bg-primary-50 rounded-lg transition {% if current_lang == 'en' %}bg-primary-100 font-bold{% endif %}">
                            English
                        </a>
                        <a href="#" data-lang="de" class="lang-switch block py-2 px-4 text-gray-700 hover:bg-primary-50 rounded-lg transition {% if current_lang == 'de' %}bg-primary-100 font-bold{% endif %}">
                            Deutsch
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    {% if messages and request.path|slice:":11" == "/backoffice" %}
        <div class="container mx-auto px-4 mt-4">
            {% for message in messages %}
                <div class="{% if message.tags == 'error' %}bg-red-100 border-red-400 text-red-700{% elif message.tags == 'success' %}bg-green-100 border-green-400 text-green-700{% else %}bg-blue-100 border-blue-400 text-blue-700{% endif %} border px-4 py-3 rounded relative mb-4" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <footer class="bg-gray-900 text-white mt-16">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">{{ SITE_NAME }}</h3>
                    <p class="text-gray-400">{% trans "Empresa constructora especializada en obra nueva, reformas y rehabilitaciones." %}</p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">{% trans "Enlaces" %}</h4>
                    <ul class="space-y-2">
                        <li><a href="{% url 'home' %}" class="text-gray-400 hover:text-white transition">{% trans "Inicio" %}</a></li>
                        <li><a href="{% url 'about' %}" class="text-gray-400 hover:text-white transition">{% trans "Sobre Nosotros" %}</a></li>
                        <li><a href="{% url 'services_list' %}" class="text-gray-400 hover:text-white transition">{% trans "Servicios" %}</a></li>
                        <li><a href="{% url 'blog_list' %}" class="text-gray-400 hover:text-white transition">Blog</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">{% trans "Servicios" %}</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li>{% trans "Obra Nueva" %}</li>
                        <li>{% trans "Reformas" %}</li>
                        <li>{% trans "Rehabilitaciones" %}</li>
                        <li>{% trans "Mantenimiento" %}</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">{% trans "Contacto" %}</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><i class="fas fa-envelope mr-2"></i> rieraconstruccions@gmail.com</li>
                        <li><i class="fas fa-phone mr-2"></i> 675378303 Jaume</li>
                        <li><i class="fas fa-phone mr-2"></i> 692674204 Oficina</li>
                        <li><i class="fas fa-map-marker-alt mr-2"></i> Poligono 6 Parcela 154 - Ctra. Manacor/Son Carrió 07500 - Manacor</li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; {% now "Y" %} {{ SITE_NAME }}. {% trans "Todos los derechos reservados." %}</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });
        
        // Language selector dropdown (desktop)
        const languageButton = document.getElementById('language-button');
        const languageMenu = document.getElementById('language-menu');
        
        if (languageButton && languageMenu) {
            languageButton.addEventListener('click', function(e) {
                e.stopPropagation();
                languageMenu.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!languageButton.contains(e.target) && !languageMenu.contains(e.target)) {
                    languageMenu.classList.add('hidden');
                }
            });
        }
        
        // Language selector dropdown (mobile)
        const mobileLanguageButton = document.getElementById('mobile-language-button');
        const mobileLanguageMenu = document.getElementById('mobile-language-menu');
        
        if (mobileLanguageButton && mobileLanguageMenu) {
            mobileLanguageButton.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileLanguageMenu.classList.toggle('hidden');
            });
        }
        
        // Language switcher
        document.querySelectorAll('.lang-switch').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetLang = this.getAttribute('data-lang');
                const currentPath = window.location.pathname;
                
                // Remove current language prefix (es, ca, en, de)
                let pathWithoutLang = currentPath.replace(/^\/(es|ca|en|de)(\/|$)/, '/');
                
                // Add new language prefix (except for Spanish which has no prefix)
                let newPath;
                if (targetLang === 'es') {
                    newPath = pathWithoutLang;
                } else {
                    newPath = '/' + targetLang + pathWithoutLang;
                }
                
                // Ensure path doesn't end with double slash
                newPath = newPath.replace(/\/+$/, '/');
                if (newPath === '//') newPath = '/';
                
                window.location.href = newPath;
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
